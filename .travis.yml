dist: focal
language: python
matrix:
  include:
    - python: 3.11
cache: pip
services:
  - docker
before_install:
  # nothing needed here yet, containers come pre-installed
install:
  - pip install -r html2md/requirements.txt
before_script:
  - docker build -t html2md-api -f html2md/Dockerfile .
  - docker build -t mysql-html2md -f html2md/models/Dockerfile .
  - docker run -d -p 127.0.0.1:3306:3306 --name mysql-html2md mysql-html2md
  - docker run -d -p 127.0.0.1:8080:8080 --name html2md-api  html2md-api
  - sleep 10
script:
  - docker ps
  - docker logs html2md-api
  - pytest
deploy:
  provider: script
  script: python3 html2md/testsql.py
  on:
    branch: main
